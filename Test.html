<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏•‡∏≤</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<style>
body { font-family: Arial; padding: 20px; }
label, input, select, button { display: block; margin-bottom: 10px; }
input, select { padding: 5px; width: 300px; }
button { padding: 8px 15px; cursor: pointer; margin-bottom: 20px; }
iframe { width: 100%; height: 500px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏•‡∏≤</h2>

<label for="nameInput">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</label>
<input type="text" id="nameInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">

<label for="typeSelect">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤:</label>
<select id="typeSelect">
  <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
  <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
  <option value="‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
</select>

<label for="startDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤:</label>
<input type="date" id="startDate">

<label for="endDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏≤:</label>
<input type="date" id="endDate">

<label for="daysInput">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô:</label>
<input type="number" id="daysInput" min="0" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤">

<button id="previewBtn">üîç ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</button>
<button id="printBtn">üñ® ‡∏õ‡∏£‡∏¥‡πâ‡∏ô PDF</button>

<iframe id="pdfPreview"></iframe>

<script>
const pdfUrl = "https://panaddas3309.github.io/BUS-Official/‡πÉ‡∏ö‡∏•‡∏≤.pdf";

async function generatePdf(data) {
  const existingPdfBytes = await fetch(pdfUrl).then(res => res.arrayBuffer());
  const { PDFDocument, StandardFonts, rgb } = PDFLib;
  const pdfDoc = await PDFDocument.load(existingPdfBytes);
  const pages = pdfDoc.getPages();
  const firstPage = pages[0];
  const font = await pdfDoc.embedFont(StandardFonts.Helvetica);

  // ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á PDF
  firstPage.drawText(`‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•: ${data.name}`, { x: 100, y: 700, size: 14, font, color: rgb(0,0,0) });
  firstPage.drawText(`‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤: ${data.type}`, { x: 100, y: 680, size: 14, font, color: rgb(0,0,0) });
  firstPage.drawText(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: ${data.start}`, { x: 100, y: 660, size: 14, font, color: rgb(0,0,0) });
  firstPage.drawText(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: ${data.end}`, { x: 100, y: 640, size: 14, font, color: rgb(0,0,0) });
  firstPage.drawText(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô: ${data.days}`, { x: 100, y: 620, size: 14, font, color: rgb(0,0,0) });

  return pdfDoc.save();
}

// ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö dd/mm/yyyy
function formatDate(dateStr){
  if(!dateStr) return "-";
  const d = new Date(dateStr);
  const day = String(d.getDate()).padStart(2,'0');
  const month = String(d.getMonth()+1).padStart(2,'0');
  const year = d.getFullYear();
  return `${day}/${month}/${year}`;
}

// ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
document.getElementById("previewBtn").addEventListener("click", async () => {
  const data = {
    name: document.getElementById("nameInput").value || "-",
    type: document.getElementById("typeSelect").value,
    start: formatDate(document.getElementById("startDate").value),
    end: formatDate(document.getElementById("endDate").value),
    days: document.getElementById("daysInput").value || "-"
  };
  const pdfBytes = await generatePdf(data);
  const blob = new Blob([pdfBytes], { type: "application/pdf" });
  document.getElementById("pdfPreview").src = URL.createObjectURL(blob);
});

// ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏¥‡πâ‡∏ô
document.getElementById("printBtn").addEventListener("click", async () => {
  const data = {
    name: document.getElementById("nameInput").value || "-",
    type: document.getElementById("typeSelect").value,
    start: formatDate(document.getElementById("startDate").value),
    end: formatDate(document.getElementById("endDate").value),
    days: document.getElementById("daysInput").value || "-"
  };
  const pdfBytes = await generatePdf(data);
  const blob = new Blob([pdfBytes], { type: "application/pdf" });
  const blobUrl = URL.createObjectURL(blob);
  window.open(blobUrl, "_blank");
});
</script>

</body>
</html>
