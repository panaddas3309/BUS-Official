<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ระบบลาออนไลน์</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
label { display: block; margin-top: 10px; }
input, textarea { width: 300px; padding: 5px; margin-bottom: 10px; }
canvas { border: 1px solid #ccc; margin-top: 10px; }
button { margin-top: 10px; padding: 10px 20px; }
iframe { width: 100%; height: 500px; margin-top: 20px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>ระบบลาออนไลน์</h2>

<form id="leaveForm">
  <label>ชื่อ-นามสกุล:</label>
  <input type="text" id="name" required>

  <label>แผนก:</label>
  <input type="text" id="department" required>

  <label>วันที่ลา:</label>
  <input type="date" id="leaveDate" required>

  <label>เหตุผล:</label>
  <textarea id="reason" rows="3" required></textarea>

  <label>ลายเซ็น:</label>
  <canvas id="signature" width="300" height="100"></canvas>
  <button type="button" id="clearSig">ล้างลายเซ็น</button>

  <button type="button" id="generatePDF">สร้าง PDF + พรีวิว</button>
</form>

<iframe id="pdfPreview"></iframe>

<script>
const { jsPDF } = window.jspdf;
const canvas = document.getElementById("signature");
const signaturePad = new SignaturePad(canvas);

document.getElementById("clearSig").addEventListener("click", () => {
  signaturePad.clear();
});

document.getElementById("generatePDF").addEventListener("click", () => {
  const name = document.getElementById("name").value.trim();
  const department = document.getElementById("department").value.trim();
  const leaveDate = document.getElementById("leaveDate").value;
  const reason = document.getElementById("reason").value.trim();

  if (!name || !department || !leaveDate || !reason) {
    alert("กรุณากรอกข้อมูลให้ครบทุกช่องครับ");
    return;
  }
  if (signaturePad.isEmpty()) {
    alert("กรุณาลงลายเซ็นด้วยครับ");
    return;
  }

  const doc = new jsPDF();

  // ใส่ข้อความภาษาไทยต้องใช้ addFont แบบ TTF หากต้องการสวย
  // ตอนนี้ใช้ default font ของ jsPDF (อ่านได้บ้าง)
  doc.setFontSize(16);
  doc.text("แบบฟอร์มใบลา", 105, 20, { align: "center" });

  doc.setFontSize(12);
  doc.text(`ชื่อ-นามสกุล: ${name}`, 20, 40);
  doc.text(`แผนก: ${department}`, 20, 50);
  doc.text(`วันที่ลา: ${leaveDate}`, 20, 60);
  doc.text(`เหตุผล: ${reason}`, 20, 70);

  // ใส่ลายเซ็น
  const sigImg = signaturePad.toDataURL("image/png");
  doc.addImage(sigImg, "PNG", 20, 80, 100, 40);

  // สร้าง blob สำหรับ preview
  const pdfBlob = doc.output("blob");
  const blobUrl = URL.createObjectURL(pdfBlob);
  document.getElementById("pdfPreview").src = blobUrl;
});
</script>

</body>
</html>
