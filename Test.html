<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î PDF ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<style>
body { font-family: Arial; padding: 20px; }
label, input, button { display: block; margin-bottom: 10px; }
input { padding: 5px; width: 300px; }
iframe { width: 100%; height: 500px; border: 1px solid #ccc; margin-top: 15px; }
</style>
</head>
<body>

<h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á PDF (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</h2>

<label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
<input type="text" id="textInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">

<label>X (‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢):</label>
<input type="number" id="xInput" value="100">

<label>Y (‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏á):</label>
<input type="number" id="yInput" value="700">

<button id="previewBtn">üîç ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
<button id="printBtn">üñ® ‡∏õ‡∏£‡∏¥‡πâ‡∏ô</button>

<iframe id="pdfPreview"></iframe>

<script>
const pdfUrl = "https://panaddas3309.github.io/BUS-Official/‡πÉ‡∏ö‡∏•‡∏≤.pdf";
const fontUrl = "AngsanaNew.ttf"; // üëâ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

async function generatePdf(text, x, y) {
  const existingPdfBytes = await fetch(pdfUrl).then(res => res.arrayBuffer());
  const fontBytes = await fetch(fontUrl).then(res => res.arrayBuffer());

  const { PDFDocument, rgb } = PDFLib;
  const pdfDoc = await PDFDocument.load(existingPdfBytes);
  const customFont = await pdfDoc.embedFont(fontBytes);

  const pages = pdfDoc.getPages();
  const firstPage = pages[0];

  firstPage.drawText(text, { 
    x: parseInt(x), 
    y: parseInt(y), 
    size: 14,          // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå 14
    font: customFont,  // ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏ó‡∏¢
    color: rgb(0,0,0)  // ‡∏™‡∏µ‡∏î‡∏≥
  });

  return pdfDoc.save();
}

document.getElementById("previewBtn").addEventListener("click", async () => {
  const text = document.getElementById("textInput").value || "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢";
  const x = document.getElementById("xInput").value;
  const y = document.getElementById("yInput").value;

  const pdfBytes = await generatePdf(text, x, y);
  const blob = new Blob([pdfBytes], { type: "application/pdf" });
  document.getElementById("pdfPreview").src = URL.createObjectURL(blob);
});

document.getElementById("printBtn").addEventListener("click", async () => {
  const text = document.getElementById("textInput").value || "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢";
  const x = document.getElementById("xInput").value;
  const y = document.getElementById("yInput").value;

  const pdfBytes = await generatePdf(text, x, y);
  const blob = new Blob([pdfBytes], { type: "application/pdf" });
  const blobUrl = URL.createObjectURL(blob);
  const printWindow = window.open(blobUrl, "_blank");
  printWindow.onload = () => {
    printWindow.focus();
    printWindow.print();
  };
});
</script>

</body>
</html>
