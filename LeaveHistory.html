<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f6fa;
    }
    header {
      background: #4a90e2;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
      position: relative;
    }
    .back-btn {
      position: absolute;
      left: 10px;
      top: 10px;
      background: white;
      color: #4a90e2;
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .container {
      padding: 10px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .card p {
      margin: 4px 0;
      font-size: 14px;
    }
    .status {
      font-weight: bold;
      padding: 3px 6px;
      border-radius: 6px;
      display: inline-block;
    }
    .status.pending { background: #f1c40f; color: white; }
    .status.approved { background: #27ae60; color: white; }
    .status.rejected { background: #e74c3c; color: white; }
  </style>
</head>
<body>
  <header>
    <button class="back-btn" onclick="window.location.href='dashboard.html'">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
    üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤
  </header>
  <div class="container" id="leave-data">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

<script>
  const scriptUrl = "https://script.google.com/macros/s/AKfycbyp7k6FlaWz36jn_D1y4l9S-Lo2UEULONr5sQMf81UWQp9AhIGx1L4GV08_p6vNkXQm/exec";

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
  function formatDate(dateStr) {
    if (!dateStr) return "-";
    const d = new Date(dateStr);
    return d.toLocaleDateString("th-TH", { year: "numeric", month: "short", day: "numeric" });
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
  function formatTime(timeStr) {
    if (!timeStr) return "-";
    const d = new Date(timeStr);
    return d.toLocaleTimeString("th-TH", { hour: "2-digit", minute: "2-digit" });
  }

  liff.init({ liffId: "2007956727-rbZz9a0z" }).then(() => {
    if (!liff.isLoggedIn()) {
      liff.login();
    } else {
      liff.getProfile().then(profile => {
        const lineUserId = profile.userId;

        fetch(scriptUrl + "?LineUserID=" + lineUserId)
          .then(res => res.json())
          .then(data => {
            const container = document.getElementById("leave-data");
            container.innerHTML = "";

            if (data.length === 0) {
              container.innerHTML = "<p class='text-center text-gray-500'>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>";
              return;
            }

            // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î
            data.sort((a, b) => new Date(b["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"]) - new Date(a["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"]));

            data.forEach(item => {
              const card = `
                <div class="card">
                  <p><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</strong> ${item["‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•"]}</p>
                  <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤:</strong> ${item["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤"]}</p>
                  <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</strong> ${formatDate(item["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°)"])} ‡∏ñ‡∏∂‡∏á ${formatDate(item["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)"])}</p>
                  <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${formatTime(item["‡πÄ‡∏ß‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°)"])} - ${formatTime(item["‡πÄ‡∏ß‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)"])}</p>
                  <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô:</strong> ${item["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô"]}</p>
                  <p><strong>Status:</strong> <span class="status ${item["Status"]}">${item["Status"]}</span></p>
                  <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${formatDate(item["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"])} ${formatTime(item["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"])}</p>
                </div>
              `;
              container.innerHTML += card;
            });
          });
      });
    }
  });
</script>

</body>
</html>
