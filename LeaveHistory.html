<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f6fa;
    }
    header {
      background: #4a90e2;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
    }
    .container {
      padding: 10px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .card p {
      margin: 4px 0;
      font-size: 14px;
    }
    .label {
      font-weight: bold;
      color: #333;
    }
    .status {
      font-weight: bold;
      padding: 3px 6px;
      border-radius: 6px;
      display: inline-block;
    }
    .status.pending { background: #f1c40f; color: white; }
    .status.approved { background: #27ae60; color: white; }
    .status.rejected { background: #e74c3c; color: white; }
  </style>
</head>
<body>
  <header>üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</header>
  <div class="container" id="leave-history">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <script>
    const liffId = "2007956727-rbZz9a0z";
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyp7k6FlaWz36jn_D1y4l9S-Lo2UEULONr5sQMf81UWQp9AhIGx1L4GV08_p6vNkXQm/exec";

    async function main() {
      await liff.init({ liffId });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      const lineUserId = profile.userId;

      fetch(scriptUrl + "?lineUserId=" + lineUserId)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("leave-history");
          container.innerHTML = "";

          if (data.length === 0) {
            container.innerHTML = "<p>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>";
            return;
          }

          data.forEach(row => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
              <p><span class="label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</span> ${row["‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•"]}</p>
              <p><span class="label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤:</span> ${row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤"]}</p>
              <p><span class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°):</span> ${formatDate(row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°)"])}</p>
              <p><span class="label">‡πÄ‡∏ß‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°):</span> ${formatTime(row["‡πÄ‡∏ß‡∏•‡∏≤(‡πÄ‡∏£‡∏¥‡πà‡∏°)"])}</p>
              <p><span class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î):</span> ${formatDate(row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)"])}</p>
              <p><span class="label">‡πÄ‡∏ß‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î):</span> ${formatTime(row["‡πÄ‡∏ß‡∏•‡∏≤(‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)"])}</p>
              <p><span class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô:</span> ${row["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô"]}</p>
              <p><span class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span> <span class="status ${row["Status"].toLowerCase()}">${row["Status"]}</span></p>
              <p><span class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span> ${formatDateTime(row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"])}</p>
            `;
            container.appendChild(card);
          });
        })
        .catch(err => {
          document.getElementById("leave-history").innerHTML = "‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
          console.error(err);
        });
    }

    function formatDate(dateStr) {
      if (!dateStr) return "-";
      const date = new Date(dateStr);
      return date.toLocaleDateString("th-TH");
    }

    function formatTime(timeStr) {
      if (!timeStr) return "-";
      const date = new Date(timeStr);
      return date.toLocaleTimeString("th-TH", { hour: "2-digit", minute: "2-digit" });
    }

    function formatDateTime(dateTimeStr) {
      if (!dateTimeStr) return "-";
      const date = new Date(dateTimeStr);
      return date.toLocaleString("th-TH");
    }

    main();
  </script>
</body>
</html>
